apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: harbor
spec:
  valuesFrom:
  - kind: ConfigMap
    name: harbor-base-config
    valuesKey: config.yaml
  - kind: ConfigMap
    name: harbor-config
    valuesKey: config.yaml
  - kind: Secret
    # generated by base/harbor-secrets.bash
    name: harbor-secrets
    valuesKey: values.yaml
  - kind: Secret
    # generated by swift-secret.bash
    name: swift-secret
    valuesKey: username
    targetPath: persistence.imageChartStorage.swift.username
  - kind: Secret
    name: swift-secret
    valuesKey: password
    targetPath: persistence.imageChartStorage.swift.password
  # workaround for https://github.com/goharbor/harbor-helm/issues/1352
  - kind: Secret
    # generated by redis/redis-secret.bash
    name: harbor-redis-auth
    valuesKey: password
    targetPath: redis.external.password
  # workaround for https://github.com/goharbor/harbor-helm/issues/1358
  - kind: Secret
    # generated by postgres-operator
    name: harbor.postgresql.credentials.postgresql.acid.zalan.do
    valuesKey: password
    targetPath: database.external.password
